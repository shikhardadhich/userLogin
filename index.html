<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/styles.css" />
    <script src="/type-effect.js"></script>
    <title>AL-Lab SCG</title>
  </head>
  <body>
    <div class="container">
      <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
      </div>
      <div class="sidebar">
        <div class="user-info">AI-Lab SCG</div>

        <div class="user-info">
          <div class="user-avatar">
            <img src="avatar.jpeg" alt="User Avatar" />
          </div>
          <div class="user-name">
            Guest User
            <!-- Replace with the user's name -->
          </div>
        </div>

        <div>Select Model</div>
        <select
          class="model-select"
          id="model-select"
          onchange="getSelectedModel(event)"
        >
          <option value="llama2">Llama 2</option>
          <option value="starcoder">StarCoder</option>
          <option value="openai">Open AI</option>
        </select>
      </div>
      <div class="chat-container">
        <div class="user-input">
          <textarea
            class="input-field"
            id="userInput"
            placeholder="Type your message..."
          ></textarea>
          <button class="send-button" id="generateBtn">Send</button>
        </div>
        <div class="chat-history" id="chat-history">
          <!-- Chat history will be populated here -->
        </div>
      </div>
    </div>

    <script>
      const generateBtn = document.getElementById("generateBtn");

      // Write a function to get show selected value from <select>

      function getSelectedModel(e) {
        if (e.target.selectedIndex == 0) {
          return true;
        } else {
          alert(
            e.target.options[e.target.selectedIndex].text + " Comming Soon"
          );
          e.target.selectedIndex = 0;
        }
      }
      generateBtn.addEventListener("click", () => {
        const loadingOverlay = document.getElementById("loading-overlay");
        loadingOverlay.style.display = "flex"; // Show loading overlay
        const userInput = document.getElementById("userInput").value;
        const aws_url =
          "https://mhifkgiv6trgxyvv73jci6tcai0mjshr.lambda-url.us-east-1.on.aws/";

        fetch(aws_url, {
          method: "POST",

          body: JSON.stringify({
            inputs: [
              [
                { role: "system", content: "You are a helpful assistant." },
                { role: "user", content: userInput },
              ],
            ],
            parameters: { max_new_tokens: 10000, top_p: 0.9, temperature: 0.6 },
          }),
        })
          .then((response) => {
            if (!response.ok) {
              loadingOverlay.style.display = "none";
              throw new Error(
                "Network response was not ok: ${response.status}"
              );
            }
            
            return response.json();
          })
          .then((response) => {
            alert(response);
            loadingOverlay.style.display = "none";
            //startTyping(JSON.stringify(response), 5, "generatedesult");
            addMessage(response, true, "");
          })
          .catch((error) => {
            loadingOverlay.style.display = "none";
            alert("Some error occurred: " + error.message)
            console.error("Fetch error:", error);
          });
      });

      // Assume you have a function to add messages to the chat history
      async function addMessage(message, isUser, languageType) {
        const chatHistory = document.getElementById("chat-history");
        const messageDiv = document.createElement("div");
        messageDiv.className = isUser ? "user-message" : "response-message";

        const headerDiv = document.createElement("div");
        headerDiv.className = "message-header";
        const languageSpan = document.createElement("span");
        languageSpan.textContent = "Agent";
        const copyButton = document.createElement("button");
        copyButton.className = "copy-code-button";
        copyButton.textContent = "Copy";

        copyButton.addEventListener("click", () => {
          // Logic to copy the message's text to clipboard
          const dummy = document.createElement("textarea");
          document.body.appendChild(dummy);
          dummy.value = message;
          dummy.select();
          document.execCommand("copy");
          document.body.removeChild(dummy);
          alert("Code copied to clipboard!");
        });

        headerDiv.appendChild(languageSpan);
        headerDiv.appendChild(copyButton);
        messageDiv.appendChild(headerDiv);

        const messageContentPre = document.createElement("pre");
        const messageContentCode = document.createElement("code");
        messageContentCode.className = "code-generate";
        messageContentCode.id = "generatedesult";

        messageContentPre.appendChild(messageContentCode);

        messageDiv.appendChild(messageContentPre);

        chatHistory.appendChild(messageDiv);

        await startTyping(message, 5, messageContentCode);

        // Scroll to the bottom of the chat history
        chatHistory.scrollTop = chatHistory.scrollHeight;
      }
    </script>
  </body>
</html>
